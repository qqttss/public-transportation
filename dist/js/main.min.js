!function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(){var e=v.value,t=w.value,n=i(e),o=i(t),r=I.value,u="";u=a(r),console.log("tripWeekday:"),console.log(u),document.querySelector("#departure-stop").value="",document.querySelector("#arrival-stop").value="",""!==e&&""!==t||(S.innerHTML=" Please input departure and arrival stops!",N.style.display="block",g.innerHTML="",b.innerHTML="",_.style.display="none",x.innerHTML=""),e===t&&""!==e&&(g.innerHTML=e,b.innerHTML=t,S.innerHTML="Departure and arrival stop cannot be the same!",_.style.display="inline-block",N.style.display="block",x.innerHTML=""),e!==t&&""!==e&&""!==t&&(g.innerHTML=e,b.innerHTML=t,_.style.display="inline-block",N.style.display="block",s(n,o,u))}function i(e){for(var t={},n=0;n<q.length;n++)e===q[n].stopName&&(t=q[n]);return t}function a(e){var t=new Date(e).getDay(),n="";return t>=0&&4>=t&&(n="Weekday"),5==t&&(n="Saturday"),6==t&&(n="Sunday"),n}function s(e,t,n){j.then(function(o){var r=o.transaction("storeOne","readwrite"),i=r.objectStore("storeOne");i.getAll().then(function(o){var r=[];for(var i in o)o[i].departure.stopId!==e.idOne&&o[i].departure.stopId!==e.idTwo||o[i].arrival.stopId!==t.idOne&&o[i].arrival.stopId!==t.idTwo||n!==o[i].serviceId||r.push(o[i]);0===r.length?c(e,t,n):(console.log("Display trips obtained from local database:"),console.log(r),u(r))})})}function u(e){for(var t=Handlebars.compile(document.getElementById("trip-entry").innerHTML),n="",o=0;o<e.length;o++)n+=t(e[o]);x.innerHTML=n}function c(e,t,n){fetch("data/GTFS/trips.txt").then(function(e){return e.text()}).then(function(e){var t,n,o=[],r=[],i=0,a=0;for(t=e.split("\n"),a=0;a<t.length;a++)n=t[a].split(","),"undefined"!=typeof n[1]&&(o[i]={},r=n[1].split("-"),o[i].serviceId=r[3],o[i].tripId=n[2],i++);return o}).then(function(o){fetch("data/GTFS/stop_times.txt").then(function(e){return e.text()}).then(function(r){for(var i,a=r.split("\n").slice(1),s=0,u=[],c=[],p=[],l=0;l<a.length;l++)i=a[l].split(","),"undefined"!=typeof i[1]&&"undefined"!=typeof i[2]&&(u[s]={},u[s].tripId=i[0],u[s].arrTime=i[1],c[s]=i[1],u[s].aTimeNum=0,u[s].aTimeNum=h(c[s].split(":")),u[s].departTime=i[2],p[s]=i[2],u[s].dTimeNum=0,u[s].dTimeNum=h(p[s].split(":")),u[s].stopId=i[3],u[s].sequence=i[4],u[s].pickupType=i[5],u[s].dropoffType=i[6],s++);for(var f=[],y=[],T=0;T<u.length;T++)u[T].stopId!==e.idOne&&u[T].stopId!==e.idTwo||f.push(u[T]),u[T].stopId!==t.idOne&&u[T].stopId!==t.idTwo||y.push(u[T]);for(var v=[],w=0,O=0;O<f.length;O++)for(var g=0;g<y.length;g++)f[O].tripId===y[g].tripId&&parseInt(f[O].sequence,10)<parseInt(y[g].sequence,10)&&(v[w]={},v[w].departure=f[O],v[w].arrival=y[g],w++);v.forEach(function(e){e.duration=0,e.serviceId="",e.duration=m(e.arrival.aTimeNum-e.departure.aTimeNum),o.forEach(function(t){e.departure.tripId===t.tripId&&(e.serviceId=t.serviceId)})});var b=[];for(s=0,l=0;l<v.length;l++)n===v[l].serviceId&&(b[s]=v[l],s++);return d(b)}).then(function(e){0===e.length&&(S.innerHTML="Trips are not available today!",x.innerHTML=""),0!==e.length&&(S.innerHTML="Trips are available today!",j.then(function(t){for(var n=t.transaction("storeOne","readwrite"),o=n.objectStore("storeOne"),r=0;r<e.length;r++)o.add(e[r])}),u(e))})})}function d(e){var t,n,o,r,i=[];for(n=0;n<e.length;n++)for(t=e[n].arrival.arrTime.split(":"),r=t.length,i[n]={},i[n].sortTime=0,o=0;r>o;o++)i[n].sortTime+=parseInt(t[o],10)*Math.pow(60,r-(o+1)),i[n].trip=e[n];var a=f(i,0,i.length-1),s=[];return a.forEach(function(e,t){s[t]=e.trip}),s}function p(e,t,n){var o=e[t].sortTime;e[t].sortTime=e[n].sortTime,e[n].sortTime=o}function l(e,t,n){for(var o=e[Math.floor((n+t)/2)].sortTime,r=t,i=n;i>=r;){for(;e[r].sortTime<o;)r++;for(;e[i].sortTime>o;)i--;i>=r&&(p(e,r,i),r++,i--)}return r}function f(e,t,n){if(e.length<2)return e;t="number"!=typeof t?0:t,n="number"!=typeof n?e.length-1:n;var o=l(e,t,n);return o-1>t&&f(e,t,o-1),n>o&&f(e,o,n),e}function m(e){var t="",n=0,o=0,r=0;return r=e%60,o=Math.floor(e%3600/60),n=Math.floor(e/3600),t=(n>0?n+"h":"")+(o>0?o+"m":"")+(r>0?r+"s":"")}function h(e){var t,n=0,o=0;for(t=e.length,o=0;t>o;o++)n+=parseInt(e[o],10)*Math.pow(60,t-(o+1));return n}var y=e("idb"),T=o(y);"serviceWorker"in navigator&&navigator.serviceWorker.register("/public-transportation/sw.js",{scope:"/public-transportation/"}).then(function(e){console.log("Registration succeeded. Scope is "+e.scope)})["catch"](function(e){console.log("Registration failed with "+e)});var v=document.querySelector("#departure-stop"),w=document.querySelector("#arrival-stop"),O=document.querySelector("#search-btn"),g=document.querySelector("#d-stop"),b=document.querySelector("#a-stop"),N=document.querySelector(".searched-stops"),S=document.querySelector(".search-notice"),_=document.querySelector("#search-arrow"),I=document.querySelector("#trip-date"),x=document.querySelector("#trips-table"),M=1,q=[{stopName:"San Francisco",idOne:"70011",idTwo:"70012"},{stopName:"22nd St",idOne:"70021",idTwo:"70022"},{stopName:"Bayshore",idOne:"70031",idTwo:"70032"},{stopName:"So. San Francisco",idOne:"70041",idTwo:"70042"},{stopName:"San Bruno",idOne:"70051",idTwo:"70052"},{stopName:"Millbrae",idOne:"70061",idTwo:"70062"},{stopName:"Broadway",idOne:"70071",idTwo:"70072"},{stopName:"Burlingame",idOne:"70081",idTwo:"70082"},{stopName:"San Mateo",idOne:"70091",idTwo:"70092"},{stopName:"Hayward Park",idOne:"70101",idTwo:"70102"},{stopName:"Hillsdale",idOne:"70111",idTwo:"70112"},{stopName:"Belmont",idOne:"70121",idTwo:"70122"},{stopName:"San Carlos",idOne:"70131",idTwo:"70132"},{stopName:"Redwood City",idOne:"70141",idTwo:"70142"},{stopName:"Atherton",idOne:"70151",idTwo:"70152"},{stopName:"Menlo Park",idOne:"70161",idTwo:"70162"},{stopName:"Palo Alto",idOne:"70171",idTwo:"70172"},{stopName:"California Ave",idOne:"70191",idTwo:"70192"},{stopName:"San Antonio",idOne:"70201",idTwo:"70202"},{stopName:"Mt View",idOne:"70211",idTwo:"70212"},{stopName:"Sunnyvale",idOne:"70221",idTwo:"70222"},{stopName:"Lawrence",idOne:"70231",idTwo:"70232"},{stopName:"Santa Clara",idOne:"70241",idTwo:"70242"},{stopName:"College Park",idOne:"70251",idTwo:"70252"},{stopName:"San Jose Diridon",idOne:"70261",idTwo:"70262"},{stopName:"Tamien",idOne:"70271",idTwo:"70272"},{stopName:"Capitol",idOne:"70281",idTwo:"70282"},{stopName:"Blossom Hill",idOne:"70291",idTwo:"70292"},{stopName:"Morgan Hill",idOne:"70301",idTwo:"70302"},{stopName:"San Martin",idOne:"70311",idTwo:"70312"},{stopName:"Gilroy",idOne:"70321",idTwo:"70322"},{stopName:"San Jose",idOne:"777402",idTwo:""},{stopName:"Tamien Station",idOne:"777403",idTwo:""}],D=new Date,H=D.getDate(),B=D.getMonth()+1,L=D.getFullYear(),k=L+"-"+(10>B?"0"+B:B)+"-"+(10>H?"0"+H:H);I.value=k;var j=T["default"].open("trip-db",M,function(e){e.createObjectStore("storeOne",{autoIncrement:!0})});O.addEventListener("click",r,!1)},{idb:2}],2:[function(e,t,n){"use strict";!function(){function e(e){return Array.prototype.slice.call(e)}function n(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function o(e,t,o){var r,i=new Promise(function(i,a){r=e[t].apply(e,o),n(r).then(i,a)});return i.request=r,i}function r(e,t,n){var r=o(e,t,n);return r.then(function(e){return e?new d(e,r.request):void 0})}function i(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]}})})}function a(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return o(this[t],r,arguments)})})}function s(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function u(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return r(this[t],o,arguments)})})}function c(e){this._index=e}function d(e,t){this._cursor=e,this._request=t}function p(e){this._store=e}function l(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new l(n)}function m(e){this._db=e}i(c,"_index",["name","keyPath","multiEntry","unique"]),a(c,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),u(c,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(d,"_cursor",["direction","key","primaryKey","value"]),a(d,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(d.prototype[e]=function(){var t=this,o=arguments;return Promise.resolve().then(function(){return t._cursor[e].apply(t._cursor,o),n(t._request).then(function(e){return e?new d(e,t._request):void 0})})})}),p.prototype.createIndex=function(){return new c(this._store.createIndex.apply(this._store,arguments))},p.prototype.index=function(){return new c(this._store.index.apply(this._store,arguments))},i(p,"_store",["name","keyPath","indexNames","autoIncrement"]),a(p,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getAllKeys","count"]),u(p,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(p,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new p(this._tx.objectStore.apply(this._tx,arguments))},i(l,"_tx",["objectStoreNames","mode"]),s(l,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new p(this._db.createObjectStore.apply(this._db,arguments))},i(f,"_db",["name","version","objectStoreNames"]),s(f,"_db",IDBDatabase,["deleteObjectStore","close"]),m.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},i(m,"_db",["name","version","objectStoreNames"]),s(m,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[p,c].forEach(function(n){n.prototype[t.replace("open","iterate")]=function(){var n=e(arguments),o=n[n.length-1],r=(this._store||this._index)[t].apply(this._store,n.slice(0,-1));r.onsuccess=function(){o(r.result)}}})}),[c,p].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){return e?(o.push(e.value),void 0!==t&&o.length==t?void r(o):void e["continue"]()):void r(o)})})})});var h={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new f(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new m(e)})},"delete":function(e){return o(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof t?t.exports=h:self.idb=h}()},{}]},{},[1]);
